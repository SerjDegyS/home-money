{"ast":null,"code":"import { Subscription } from 'rxjs';\nimport { concatMap, delay } from 'rxjs/operators';\nimport { Message } from '../../shared/models/message.model';\nimport { fadeStateTrigger } from '../../shared/animations/fade.animation';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../shared/services/bill.service\";\nimport * as i2 from \"../../shared/services/users.service\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"@angular/platform-browser\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"../../shared/components/loader/loader.component\";\nimport * as i7 from \"./bill-card/bill-card.component\";\nimport * as i8 from \"./currency-card/currency-card.component\";\nfunction BillPageComponent_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵclassMapInterpolate1(\"alert alert-\", ctx_r0.message.type, \"\");\n    i0.ɵɵproperty(\"@fade\", undefined);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.message.text, \" \");\n  }\n}\nfunction BillPageComponent_div_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 10);\n    i0.ɵɵelement(1, \"degys-loader\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction BillPageComponent_div_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 11);\n    i0.ɵɵelement(1, \"degys-bill-card\", 12)(2, \"degys-currency-card\", 12);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"bill\", ctx_r2.bill)(\"currency\", ctx_r2.currency);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"bill\", ctx_r2.bill)(\"currency\", ctx_r2.currency);\n  }\n}\nexport let BillPageComponent = /*#__PURE__*/(() => {\n  class BillPageComponent {\n    constructor(billService, usersService, route, title) {\n      this.billService = billService;\n      this.usersService = usersService;\n      this.route = route;\n      this.title = title;\n      this.sub1 = new Subscription();\n      this.user = JSON.parse(window.localStorage.getItem('user'));\n      // hasBill = true;\n      this.isLoaded = false;\n      this.message = new Message();\n      this.searchPlaceholder = '';\n      title.setTitle('Счет и курс валют');\n    }\n    ngOnInit() {\n      this.sub1.add(this.route.queryParams.subscribe(params => {\n        if (params.createdBill) {\n          this.message.showMessage('success', 'Теперь у Вас есть счет!', 5000);\n          // this.showBill();\n        }\n      }));\n\n      console.log(this.user);\n      this.sub1.add(this.billService.getBill(this.user.bill).pipe(concatMap(bill => {\n        this.bill = bill;\n        return this.billService.getCurrency(this.bill.currency);\n      })).subscribe(data => {\n        this.currency = data;\n        this.isLoaded = true;\n      }));\n    }\n    onRefresh() {\n      this.isLoaded = false;\n      this.sub1.add(this.billService.getCurrency(this.bill.currency).pipe(delay(2000)).subscribe(currency => {\n        this.currency = currency;\n        this.isLoaded = true;\n      }));\n    }\n    // createBill() {\n    //   this.hasBill = false;\n    //\n    // }\n    showBill() {\n      this.sub1.add(this.billService.getCurrency(this.bill.currency).subscribe(data => {\n        console.log(data);\n        this.currency = data;\n        this.isLoaded = true;\n      }));\n    }\n    // onSubmit(form: NgForm) {\n    //   const {billValue} = form.value;\n    //   this.bill = new Bill(billValue, this.currency, this.user.id);\n    //\n    //   this.sub1.add(this.billService.createBill(this.bill)\n    //     .pipe(\n    //       mergeMap((bill) => {\n    //         console.log(bill)\n    //         this.user.bill = bill.id;\n    //         return this.usersService.updateUser(this.user);\n    //       } )\n    //     ).subscribe( (user: User) => {\n    //       window.localStorage.setItem('user', JSON.stringify(user));\n    //       this.hasBill = true;\n    //       this.showBill();\n    //       }\n    //     ));\n    // }\n    //\n    // setCurrency(c: string) {\n    //   this.currency = c;\n    // }\n    ngOnDestroy() {\n      if (this.sub1) {\n        this.sub1.unsubscribe();\n      }\n    }\n  }\n  BillPageComponent.ɵfac = function BillPageComponent_Factory(t) {\n    return new (t || BillPageComponent)(i0.ɵɵdirectiveInject(i1.BillService), i0.ɵɵdirectiveInject(i2.UsersService), i0.ɵɵdirectiveInject(i3.ActivatedRoute), i0.ɵɵdirectiveInject(i4.Title));\n  };\n  BillPageComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: BillPageComponent,\n    selectors: [[\"degys-bill-page\"]],\n    decls: 12,\n    vars: 4,\n    consts: [[1, \"title-block\"], [1, \"title\", \"pull-left\"], [1, \"sparkline\", \"bar\"], [1, \"pull-right\"], [1, \"btn-sm\", \"btn\", \"btn-primary-outline\", 3, \"click\"], [1, \"fa\", \"fa-refresh\"], [3, \"class\", 4, \"ngIf\"], [1, \"section\"], [\"class\", \"row text-center\", 4, \"ngIf\"], [\"class\", \"row\", 4, \"ngIf\"], [1, \"row\", \"text-center\"], [1, \"row\"], [3, \"bill\", \"currency\"]],\n    template: function BillPageComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\")(1, \"div\", 0)(2, \"h3\", 1);\n        i0.ɵɵtext(3, \" \\u0421\\u0442\\u0440\\u0430\\u043D\\u0438\\u0446\\u0430 \\u0441\\u0447\\u0435\\u0442\\u0430 \");\n        i0.ɵɵelement(4, \"span\", 2);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(5, \"div\", 3)(6, \"button\", 4);\n        i0.ɵɵlistener(\"click\", function BillPageComponent_Template_button_click_6_listener() {\n          return ctx.onRefresh();\n        });\n        i0.ɵɵelement(7, \"i\", 5);\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵtemplate(8, BillPageComponent_div_8_Template, 2, 5, \"div\", 6);\n        i0.ɵɵelementStart(9, \"section\", 7);\n        i0.ɵɵtemplate(10, BillPageComponent_div_10_Template, 2, 0, \"div\", 8);\n        i0.ɵɵtemplate(11, BillPageComponent_div_11_Template, 3, 4, \"div\", 9);\n        i0.ɵɵelementEnd()();\n      }\n      if (rf & 2) {\n        i0.ɵɵproperty(\"@fade\", undefined);\n        i0.ɵɵadvance(8);\n        i0.ɵɵproperty(\"ngIf\", ctx.message.text);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", !ctx.isLoaded);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.isLoaded);\n      }\n    },\n    dependencies: [i5.NgIf, i6.LoaderComponent, i7.BillCardComponent, i8.CurrencyCardComponent],\n    data: {\n      animation: [fadeStateTrigger]\n    }\n  });\n  return BillPageComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}